define("widgets/core/widgetDataHelper",["lodash"],function(a){"use strict";return{registerWidgetHandler:function(b,c,d){a.set(b,["widgetHandlers",c],d)},getWidgetHandler:function(b,c){return a.get(b,["widgetHandlers",c])},registerWidgetInstance:function(b,c,d,e){a.set(b,["widgetInstances",c,"handlerId"],d),a.set(b,["widgetInstances",c,"type"],e)},getWidgetInstanceHandler:function(a,b){var c=this.getWidgetInstanceHandlerId(a,b);return this.getWidgetHandler(a,c)},getWidgetInstanceHandlerId:function(b,c){return a.get(b,["widgetInstances",c,"handlerId"])},updateWidgetComponents:function(b,c,d){a.set(b,["widgetInstances",c,"components"],d)},getWidgetComponents:function(b,c){return a.get(b,["widgetInstances",c,"components"],[])},getWidgetType:function(b,c){return a.get(b,["widgetInstances",c,"type"])},getRegisteredWidgetIds:function(b){return a.keys(b.widgetInstances)}}}),define("widgets/core/WidgetAspect",["lodash","utils","widgets/core/widgetDataHelper","experiment"],function(a,b,c,d){"use strict";function e(a){this.siteAPI=a,this.siteAPI.getRuntimeDal().registerChangeListener(h.bind(this)),d.isOpen("sv_hoverBox")&&this.siteAPI.getSiteDataAPI().registerDisplayedJsonUpdateCallback(i.bind(this))}function f(b,d){var e=b.getSiteData().widgetsStore,f=c.getRegisteredWidgetIds(e);return a(f).map(function(a){return{widgetId:a,handlerId:c.getWidgetInstanceHandlerId(e,a),compIds:c.getWidgetComponents(e,a)}}).filter(function(b){return!a.isEmpty(a.intersection(b.compIds,d))}).groupBy("handlerId").mapValues(function(b){return a.map(b,"widgetId")}).value()}function g(b,c,d){b=a.isArray(b)?b:[b];var e=f(this.siteAPI,b);a.forEach(e,function(b,e){var f=this.getWidgetHandler(e);f&&a.forEach(b,function(a){c.call(d,f,a)},this)},this)}function h(b,c){var d={dataChange:"data",propsChange:"props",stateChange:"state",layoutChange:"layout"},e=a.zipObject([d[c.type]],[c.value]),f=a.zipObject([b],[e]);g.call(this,b,function(a,b){a.handleWidgetUpdate(b,f)},this)}function i(c,d){if(a.includes(this.siteAPI.getAllRenderedRootIds(),c)){var e=this.siteAPI.getRuntimeDal(),f=this.siteAPI.getSiteDataAPI(),h=f.document.getAllCompsUnderRoot(c,d),i=a.reduce(h,function(a,c){return a[c.id]=b.widgetModel.getCompModel(e,c.id),a},{});g.call(this,d,function(b,c){b.handleWidgetUpdate(c,a.pick(i,this.getWidgetComponents(c)))},this)}}return e.prototype.registerWidgetHandler=function(a,b){var d=this.siteAPI.getSiteData().widgetsStore;c.registerWidgetHandler(d,a,b)},e.prototype.getWidgetHandler=function(a){var b=this.siteAPI.getSiteData().widgetsStore;return c.getWidgetHandler(b,a)},e.prototype.registerWidgetInstance=function(a,b,d){var e=this.siteAPI.getSiteData().widgetsStore;c.registerWidgetInstance(e,a,b,d)},e.prototype.getWidgetInstanceHandler=function(a){var b=this.siteAPI.getSiteData().widgetsStore;return c.getWidgetInstanceHandler(b,a)},e.prototype.updateWidgetComponents=function(a,b){var d=this.siteAPI.getSiteData().widgetsStore;c.updateWidgetComponents(d,a,b)},e.prototype.getWidgetComponents=function(a){var b=this.siteAPI.getSiteData().widgetsStore;return c.getWidgetComponents(b,a)},e.prototype.getWidgetType=function(a){var b=this.siteAPI.getSiteData().widgetsStore;return c.getWidgetType(b,a)},e}),define("widgets/core/widgetInterfaceBuilder",[],function(){"use strict";function a(a,b,c){var d=a.getWidgetType(b),e=a.getWidgetComponents(b);return{type:d,widgetInstanceId:b,components:e||[],displayName:c}}return{build:a}}),define("widgets/behaviors/widgetBehaviorHandler",["lodash"],function(a){"use strict";function c(a,b,c){var d=b.getSiteAspect("WidgetAspect"),e=d.getWidgetInstanceHandler(a.targetId);e.handleEvent(a.targetId,a.name,a.params,c)}function d(c){var d=a.at(c,b);return d.push(c.params.callbackId),d.join(",")}var b=["type","name","targetId"];return{handle:c,getUniqueIdentifier:d}}),define("widgets",["core","widgets/core/WidgetAspect","widgets/core/widgetInterfaceBuilder","widgets/core/widgetDataHelper","widgets/behaviors/widgetBehaviorHandler"],function(a,b,c,d,e){"use strict";return a.behaviorHandlersFactory.registerHandler("widget",e),a.siteAspectsRegistry.registerSiteAspect("WidgetAspect",b),{widgetInterfaceBuilder:c,widgetDataHelper:d}});